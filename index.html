<!DOCTYPE html>
<html>

<head>
    <title>673 Module 07 N Williamson</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <!-- <link rel="stylesheet" href="css/leaflet-search.css" /> -->
    <!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> -->

    <style>
        html,
        body,
        #map {
            height: 100%;
            padding: 0;
            margin: 0;
        }

        h1 {
            position: absolute;
            z-index: 650;
            top: 10px;
            left: 50px;
            padding: 8px 15px;
            margin: 0;
            color: whitesmoke;
            font-size: 2em;
            background: rgba(192, 192, 192, 0.2);
            border-radius: 5px;
        }

        #findbox {
            background: #eee;
            border-radius: .125em;
            border: 2px solid #1978cf;
            box-shadow: 0 0 8px #999;
            margin-bottom: 10px;
            padding: 2px 0;
            width: 600px;
            height: 26px;
        }

        .search-tooltip {
            width: 200px;
        }

        .leaflet-control-search .search-cancel {
            position: static;
            float: left;
            margin-left: -22px;
        }
        /* Try Ramiro's code begin */

        #wraper-tree-selector {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .js-tree-selector {
            width: 175px;
        }

        #search {
            position: absolute;
            z-index: 800;
            top: 20px;
            right: 20px;
            height: 300px;
            display: block;
        }

        .tt-menu {
            background: whitesmoke;
            padding: 4px;
        }

        .tt-dropdown-menu {
            background-color: #fff;
            border: 1px solid #000;
        }

        .tt-suggestion.tt-cursor {
            background-color: #ccc;
        }

        .triggered-events {
            float: right;
            width: 500px;
            height: 300px;
        }
    </style>
</head>


<body>
    <h1>University of Kentucky Tree Map</h1>
    <div id="map"></div>

    <!-- <div id="search">
      <label for="plant-names">Plant names: </label>
      <input id="plant-names">
    </div> -->

    <div id="search">
        <input class="plants" type="text" value="Search">
    </div>

    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script> -->
    <!-- <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->
    <script src="js/typeahead.bundle.js"></script>

    <script>
        // get selector
        var selector = $(".js-tree-selector"),
            query = "SELECT * FROM ukntrees_adopt_oct62016b_1";

        var map = L.map('map', {
            center: [38.0348, -84.505],
            zoom: 16,

        });

        L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
        }).addTo(map);


        var styles = {
            stroke: false,
            color: 'green',
            radius: 4,
            fillOpacity: 1
        }

        var commonNames = [];

        $.getJSON('https://npwi222.carto.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM ukntrees_adopt_oct62016b_1', function(data) {

            var dataLayer = L.geoJson(data, {

                pointToLayer: function(feature, ll) {
                    return L.circleMarker(ll, styles);
                },
                onEachFeature: function(feature, marker) {

                    var props = feature.properties;

                    // if we haven't added the name to the array
                    if (commonNames.indexOf(props.common) == -1) {
                        // add it to the array
                        commonNames.push(props.common);
                    }

                    marker.bindTooltip('Common: <br>' + props.common + '<br>' +
                        'Botanical: <br>' + props.botanical);
                }
            }).addTo(map);


            var substringMatcher = function(strs) {
                return function findMatches(q, cb) {
                    var matches, substringRegex;

                    // an array that will be populated with substring matches
                    matches = [];

                    // regex used to determine if a string contains the substring `q`
                    substrRegex = new RegExp(q, 'i');

                    // iterate through the pool of strings and for any string that
                    // contains the substring `q`, add it to the `matches` array
                    $.each(strs, function(i, str) {
                        if (substrRegex.test(str)) {
                            matches.push(str);
                        }
                    });

                    cb(matches);
                };
            };

            var search = $('#search .plants').typeahead({
                hint: true,
                highlight: true,
                minLength: 1
            }, {
                name: 'plants',
                source: substringMatcher(commonNames)
            });

            // when the user selects a new tree name
            search.change(function(){
                // get the selection
                var selectedVal = search.typeahead('val');

                // loop through all of our tree layers
                dataLayer.eachLayer(function(layer) {

                    // highlight the selected ones
                    if(layer.feature.properties.common == selectedVal) {
                        layer.setStyle({
                            fillOpacity: 1
                        })
                    } else {
                        // dehighlight the others
                        layer.setStyle({
                            fillOpacity: .2
                        })
                    }
                });
            })


        });
    </script>
</body>

</html>
