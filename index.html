<!DOCTYPE html>
<html>

<head>
    <title>673 Module 07 N Williamson</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />

    <style>
        html,
        body,
        #map {
            height: 100%;
            padding: 0;
            margin: 0;
        }

        h1 {
            position: absolute;
            z-index: 650;
            top: 10px;
            left: 50px;
            padding: 8px 15px;
            margin: 0;
            color: whitesmoke;
            font-size: 2em;
            background: rgba(192, 192, 192, 0.2);
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <h1>University of Kentucky Tree Map</h1>
    <div id="map"></div>

    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>

    <script type="cartocss/html" id="tree-styles">

        #layer { marker-fill: #00FF7F; marker-allow-overlap: true; [distinc=1] { marker-fill: #52d017; } [distinc=2] { marker-fill: #136400; } [distinc=3] { marker-fill: #0000FF; } }

    </script>


    <script type="infowindow/html" id="infowindow_template">
    <div class="CDB-Tooltip CDB-Tooltip--isLight">
      <ul class="CDB-Tooltip-list">
          <li class="CDB-Tooltip-listItem">
              <h3 class="CDB-Tooltip-listTitle">dbh_bin</h3>
            <h4 class="CDB-Tooltip-listText">{{dbh_bin}}</h4>
          </li>
          <li class="CDB-Tooltip-listItem">
              <h3 class="CDB-Tooltip-listTitle">exact_dbh</h3>
            <h4 class="CDB-Tooltip-listText">{{exact_dbh}}</h4>
          </li>
          <li class="CDB-Tooltip-listItem">
              <h3 class="CDB-Tooltip-listTitle">botanical</h3>
            <h4 class="CDB-Tooltip-listText">{{botanical}}</h4>
          </li>
          <li class="CDB-Tooltip-listItem">
              <h3 class="CDB-Tooltip-listTitle">common</h3>
            <h4 class="CDB-Tooltip-listText">{{common}}</h4>
          </li>
      </ul>
    </div>
    </script>

    <script>
        var map = L.map('map', {
            center: [38.035, -84.505],
            zoom: 15,
        });

        var sourceObject = {
            user_name: 'npwi222',
            type: 'cartodb',
            sublayers: [{
                    type: "http",
                    urlTemplate: "http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",
                    subdomains: ["a", "b", "c"]
                },
                {
                    sql: "SELECT * FROM ukntrees_adopt_oct62016b_1",
                    cartocss: $("#tree-styles").text(),
                    interactivity: 'cartodb_id'
                }
            ]
        }

        cartodb.createLayer(map, sourceObject, {
            infowindows: true,
        })
            .addTo(map)
            .done(function(layer) {

                    var sublayer = layer.getSubLayer(1);

                    cartodb.vis.Vis.addInfowindow(map, sublayer, ['common', 'botanical', 'exact_dbh', 'treeid'], {
                        infowindowTemplate: $('#infowindow_template').text(),
                        templateType: 'mustache'
                    });

                      layer.leafletMap.viz.addOverlay({
                      type: 'tooltip',
                      layer: sublayer,
                      template: $('#infowindow_template').text(),
                      position: 'bottom|right',
                      fields: [{ common:'common', botanical:'botanical', exact_dbh:'exact_dbh', treeid: 'treeid'}]
                      });

            });

    </script>
</body>

</html>
